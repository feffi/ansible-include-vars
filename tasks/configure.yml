---
- name: Checking if directory exists
  stat:
    path: "{{ item }}"
  with_items: "{{ macos_include_vars.paths }}"
  register: macos_include_vars_dir
  loop_control:
    label: "{{ item }}"

- name: "Include all {{ macos_include_vars.extensions | map('regex_replace', '(.*)', '*.\\1') | join(',') }} files"
  include_vars:
    dir: "{{ item.item }}"
    depth: "{{ macos_include_vars.depth }}"
    extensions: "{{ macos_include_vars.extensions }}"
    ignore_files: "{{ macos_include_vars.excludes }}"
  with_items: "{{ macos_include_vars_dir.results }}"
  when: item.stat.exists
  register: included
  loop_control:
    label: "{{ item.item }}"

- name: Included the following files
  debug:
    msg: "{{ included.results.0.ansible_included_var_files }}"
